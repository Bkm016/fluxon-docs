---
title: "函数目录"
description: "fluxon-functions.json 的结构、生成方式与消费方"
---

# 函数目录

运行时所有系统函数与扩展函数都会被导出为 `fluxon-functions.json`，供 VS Code 补全、Mintlify 文档以及其他工具共享。该文件由 `core` 模块在构建阶段生成，本文档给出字段定义、生成命令与常见消费方。

## 结构定义

目录由 `org.tabooproject.fluxon.tool.FunctionDumper` 输出，包含三个顶级字段：

```json
{
  "generatedAt": "2025-11-15T08:35:12.123Z",
  "system": [
    { "name": "print", "namespace": null, "params": [1], "async": false, "primarySync": true }
  ],
  "extensions": {
    "java.io.File": [
      { "name": "readText", "namespace": "fs:io", "params": [0], "async": false, "primarySync": true }
    ]
  }
}
```

- `generatedAt`：UTC 时间戳。
- `system`：通过 `FluxonRuntime#registerFunction` 注册的全局/命名空间函数列表。
- `extensions`：按宿主类型分组的扩展函数，键为 `Class#getName()`。

每个函数条目包含：

| 字段 | 说明 |
| --- | --- |
| `name` | 函数名（去除命名空间前缀） |
| `namespace` | 命名空间，`null` 表示无需 `import` |
| `params` | 合法的参数个数列表，支持多版本重载 |
| `async` | 是否异步函数（需 `await`） |
| `primarySync` | 是否强制主线程执行 |

## 如何生成

推荐使用 Gradle 任务（自动准备 classpath）：

```bash
./gradlew :core:dumpFluxonCatalog
# 输出 core/build/fluxon-functions.json
```

如需自定义输出路径，可直接调用导出器：

```bash
./gradlew :core:jar
java -cp core/build/libs/fluxon-core-*.jar org.tabooproject.fluxon.tool.FunctionDumper ./out/catalog.json
```

## 何时重新导出

- 新增 / 删除 / 重命名运行时函数或扩展函数。
- 变更参数个数、命名空间或同步/异步属性。
- 发布 VS Code 扩展或更新 Mintlify 文档前。

## 典型消费方

- `vscode-extension/scripts/sync-catalog.js`：将目录复制到扩展数据目录，驱动补全。
- 文档：《工具与生态 / 函数目录与补全》直接引用该结构示例。
- 外部工具：可按字段含义解析 JSON，自行生成提示或校验。

保持函数目录与源码一致，可以避免补全缺失、文档不匹配等问题。

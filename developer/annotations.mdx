---
title: "运行时注解与可选参数"
description: "@Optional、@Export 等注解在 runtime-core 中的作用"
---

运行时仅暴露少量注解用于描述导出方法的语义，主要位于 `core/runtime/java` 包，供 `ExportRegistry` 读取后生成扩展函数。

## `@Export`

- 标记 public 方法，以便被 `ExportRegistry` 扫描并注册为扩展函数。
- 可在注册时指定 `namespace`，方法名会经过 `StringUtils.transformMethodName` 去除 `get` 前缀。

## `@Optional`

- 作用于参数，表示从该参数开始均为可选。
- `ExportRegistry` 会生成从“必选参数数”到“总参数数”的所有 `paramCount`，便于脚本短参调用。

示例：

```java
@Export
public String encode(String text, @Optional String charset) { ... }
```

生成的 `params` = `[1, 2]`，脚本可传 1 或 2 个参数。

## 扩展自定义语义

`ExportMethod` 预留了 `async` / `primarySync` 标志，若需扩展语义可以增加自定义注解并在扫描时设置属性，例如：

```java
@Retention(RUNTIME)
@Target(METHOD)
public @interface ExportAsync {}
```

扫描时将 `ExportMethod#setAsync(true)`，最终由 `registerAsyncExtensionFunction` 注册。

## 与调用时的关系

- 注解决定的参数个数会影响 `FunctionContext#hasArgument` 判定；缺少必需参数会在语义分析阶段报错。
- 类型校验由扩展函数实现内部负责，建议使用 `FunctionContext#getNumber/getArgumentByType` 抛出一致的 `ArgumentTypeMismatchError`。

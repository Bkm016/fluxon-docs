---
title: "运行时配置与调试"
description: "主线程执行器、线程池、函数目录等可调整点"
---

`FluxonRuntime` 可调整线程模型与导出资产；`ThreadPoolManager` 管理异步执行。本页汇总常用开关与调试手段。

## 主线程执行器

- 默认：`Executors.newSingleThreadExecutor()`。
- 自定义：`FluxonRuntime#setPrimaryThreadExecutor(Executor executor)`，常用于绑定游戏/GUI 主线程。
- 生效范围：通过 `registerPrimarySyncFunction` / `registerSyncExtensionFunction` 注册的函数。

## 线程池管理器

- 位于 `runtime/concurrent/ThreadPoolManager`，负责异步/调度任务。
- 能力：`submitAsync`、`runAsync`、`schedule`、`scheduleAtFixedRate`、`shutdown`，以及 `getActiveTaskCount()` 观测任务堆积。
- 策略：队列满时启用 `CallerRunsPolicy`，需评估宿主线程承受能力。

## 函数目录导出

- 命令：`./gradlew :core:dumpFluxonCatalog` 输出 `core/build/fluxon-functions.json`。
- 同步：`vscode-extension/scripts/sync-catalog.js` 复制到扩展数据目录，驱动补全。
- 字段：`generatedAt`, `system`, `extensions`, `params`, `async`, `primarySync`。新增/改名后务必重跑。

## 环境调试

- `Environment#getRootFunctions()` / `getRootExtensionFunctions()` / `getRootVariables()`：检查脚本可见符号。
- `FunctionContext#toString()`：定位 target 与实参。
- `FluxonRuntime#getSystemVariables()`：查看全局对象（如 `GlobalObject`）。

## 常见问题

1. **新增函数未生效？** 注册后需重新 `newEnvironment()` 触发 bake。
2. **主线程函数仍跑在后台？** 核对是否使用 `registerPrimarySyncFunction`/`registerSyncExtensionFunction`，并确认替换了主线程执行器。
3. **异步堵塞？** `CallerRunsPolicy` 出现表示队列已满，需拆分任务或扩容宿主线程资源。
